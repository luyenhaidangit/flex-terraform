# Cursor Rules for flex-terraform

## Naming Convention

When naming AWS resources and Terraform variables, follow this standard formula:

```
<project>-<environment>-<purpose>-<tier>-<az>-<resource>
```

### Components

| Component     | Description                          | Examples                          |
|---------------|--------------------------------------|-----------------------------------|
| `project`     | Project or application name          | `flex`, `myapp`, `acme`           |
| `environment` | Deployment environment               | `dev`, `stg`, `prod`              |
| `purpose`     | Function or service name             | `web`, `api`, `db`, `bastion`     |
| `tier`        | Network tier                         | `public`, `private`, `data`       |
| `az`          | Availability zone suffix (optional)  | `a`, `b`, `c`                     |
| `resource`    | AWS resource type                    | `sg`, `subnet`, `rtb`, `igw`, `nat`, `ec2`, `rds` |

### Examples

```hcl
# VPC
flex-dev-vpc

# Subnets
flex-dev-public-a-subnet
flex-dev-private-b-subnet
flex-dev-data-c-subnet

# Security Groups
flex-dev-bastion-sg
flex-dev-web-sg
flex-dev-rds-sg

# EC2 Instances
flex-dev-bastion-ec2
flex-prod-web-a-ec2

# RDS
flex-prod-primary-rds

# NAT Gateway
flex-dev-a-nat

# Internet Gateway
flex-dev-igw

# Route Tables
flex-dev-public-rtb
flex-dev-private-a-rtb
```

### Rules

1. **Always use lowercase** with hyphens (`-`) as separators
2. **Omit optional components** if not applicable (e.g., skip `az` for single-AZ resources)
3. **Keep names short but descriptive** - abbreviate where possible (`sg` not `security-group`)
4. **Be consistent** across all modules and environments
5. **Use `name` variable** as prefix in modules, which should contain `<project>-<environment>`

### In Terraform Modules

```hcl
# Module receives name prefix (e.g., "flex-dev")
variable "name" {
  description = "Prefix for resources (format: <project>-<environment>)"
  type        = string
}

# Resource naming
resource "aws_security_group" "bastion_sg" {
  name = "${var.name}-bastion-sg"  # Results in: flex-dev-bastion-sg
  ...
}
```

## Tags Convention

### Rules

1. **Do NOT use `merge()` with `var.tags`** - Use simple tags with only `Name` tag
2. **Do NOT define `tags` variable** in modules - Tags are managed via default tags in provider configuration
3. **Always use simple tag structure** with only `Name` tag

### Correct Usage

```hcl
# ✅ CORRECT - Simple tags with Name only
resource "aws_iam_role" "example" {
  name = "${var.name}-example-role"
  
  tags = {
    Name = "${var.name}-example-role"
  }
}

# ✅ CORRECT - No tags variable needed
variable "name" {
  description = "Name prefix"
  type        = string
}
```

### Incorrect Usage

```hcl
# ❌ WRONG - Do not use merge with var.tags
resource "aws_iam_role" "example" {
  tags = merge(
    var.tags,
    { Name = "${var.name}-example-role" }
  )
}

# ❌ WRONG - Do not define tags variable
variable "tags" {
  type = map(string)
  default = {}
}
```

### Rationale

- Tags are managed centrally via AWS provider default tags configuration
- Simplifies module code and reduces unnecessary variables
- Consistent with existing IAM modules (`bastion`, `cluster`, `gha_codecommit`)

